#!/usr/bin/env sh

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# é”™è¯¯è®¡æ•°
ERRORS=0

echo "${BLUE}ğŸš€ Running pre-commit checks...${NC}"

# 1. æ£€æŸ¥å‰ç«¯ä»£ç  (ESLint + Prettier)
echo "${BLUE}ğŸ” Checking frontend code quality and format...${NC}"
yarn review:frontend
if [ $? -ne 0 ]; then
  echo "${RED}âŒ Frontend code check failed!${NC}"
  echo "${YELLOW}ğŸ’¡ Fix with: yarn fix:frontend${NC}"
  ERRORS=$((ERRORS + 1))
fi

# 2. æ£€æŸ¥Rustä»£ç  (ç¼–è¯‘ + Clippy)
echo "${BLUE}ğŸ” Checking Rust code compilation and quality...${NC}"
yarn review:rust
if [ $? -ne 0 ]; then
  echo "${RED}âŒ Rust code check failed!${NC}"
  echo "${YELLOW}ğŸ’¡ Fix with: yarn fix:rust${NC}"
  ERRORS=$((ERRORS + 1))
fi

# æ€»ç»“
if [ $ERRORS -eq 0 ]; then
  echo "${GREEN}âœ… All pre-commit checks passed!${NC}"
  exit 0
else
  echo "${RED}âŒ Pre-commit checks failed with $ERRORS error(s)!${NC}"
  echo ""
  echo "${YELLOW}ğŸ“‹ ä¿®å¤æ­¥éª¤:${NC}"
  echo "   1. ä¿®å¤å‰ç«¯ä»£ç : ${BLUE}yarn fix:frontend${NC}"
  echo "   2. ä¿®å¤Rustä»£ç : ${BLUE}yarn fix:rust${NC}"
  echo ""
  echo "${YELLOW}ğŸ’¡ ä¸€é”®ä¿®å¤æ‰€æœ‰é—®é¢˜:${NC}"
  echo "   ${BLUE}yarn fix${NC}"
  echo ""
  echo "${YELLOW}ğŸ’¡ ä¸€é”®æ£€æŸ¥æ‰€æœ‰é—®é¢˜:${NC}"
  echo "   ${BLUE}yarn review${NC}"
  echo ""
  echo "${RED}è¯·ä¿®å¤ä¸Šè¿°é—®é¢˜åé‡æ–°æäº¤ï¼${NC}"
  exit 1
fi