å¥½çš„ï¼è®©æˆ‘è¯¦ç»†è§£é‡Šä¸€ä¸‹è¿™ä¸ªå›¾ç‰‡åŠ è½½å’Œæ˜¾ç¤ºçš„å®Œæ•´æµç¨‹ï¼š

## ï¿½ï¿½ æ•´ä½“æ•°æ®æµç¨‹

```
PNG æ–‡ä»¶ â†’ Rust è§£ç  â†’ å‰ç«¯æ¥æ”¶ â†’ WebGL çº¹ç† â†’ Canvas æ˜¾ç¤º
```

## ï¿½ï¿½ Rust ç«¯ï¼ˆåç«¯ï¼‰

### 1. **å›¾ç‰‡è§£ç **

```rust
let img = image::open(file_path).map_err(|e| format!("å›¾ç‰‡è§£ç å¤±è´¥: {}", e))?;
```

- ä½¿ç”¨ `image` crate æ‰“å¼€ PNG æ–‡ä»¶
- è‡ªåŠ¨è§£ç  PNG æ ¼å¼ï¼Œè½¬æ¢ä¸ºå†…å­˜ä¸­çš„å›¾ç‰‡å¯¹è±¡
- å¦‚æœå¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯

### 2. **è·å–å°ºå¯¸ä¿¡æ¯**

```rust
let (width, height) = img.dimensions();
```

- ä»è§£ç åçš„å›¾ç‰‡ä¸­æå–å®½åº¦å’Œé«˜åº¦
- ä½ çš„å›¾ç‰‡æ˜¯ 6000x3818 åƒç´ 

### 3. **æ ¼å¼è½¬æ¢**

```rust
let rgba_img = img.to_rgba8();
let pixels = rgba_img.into_raw();
```

- å°†å›¾ç‰‡è½¬æ¢ä¸º RGBA8 æ ¼å¼ï¼ˆæ¯ä¸ªåƒç´  4 å­—èŠ‚ï¼‰
- `into_raw()` æå–åŸå§‹å­—èŠ‚æ•°æ®
- æ€»å­—èŠ‚æ•°ï¼š6000 Ã— 3818 Ã— 4 = 91,632,000 å­—èŠ‚

### 4. **æ„å»ºæ•°æ®åŒ…**

```rust
let mut data = Vec::with_capacity(8 + pixels.len());
data.extend_from_slice(&width.to_be_bytes());  // å‰4å­—èŠ‚ï¼šå®½åº¦
data.extend_from_slice(&height.to_be_bytes()); // ä¸­é—´4å­—èŠ‚ï¼šé«˜åº¦
data.extend_from_slice(&pixels);              // å‰©ä½™å­—èŠ‚ï¼šåƒç´ æ•°æ®
```

**æ•°æ®åŒ…ç»“æ„ï¼š**

```
[å®½åº¦4å­—èŠ‚][é«˜åº¦4å­—èŠ‚][åƒç´ æ•°æ®...]
[6000][3818][RGBAåƒç´ 1][RGBAåƒç´ 2]...
```

## ğŸŒ å‰ç«¯ï¼ˆTypeScriptï¼‰

### 1. **æ¥æ”¶æ•°æ®**

```typescript
const imageBuffer = await invoke("read_file");
```

- è°ƒç”¨ Rust å‡½æ•°ï¼Œæ¥æ”¶ ArrayBuffer æ•°æ®

### 2. **è§£æå°ºå¯¸ä¿¡æ¯**

```typescript
const data = new Uint8Array(imageBuffer);
const width = new DataView(data.buffer).getUint32(0); // è¯»å–å‰4å­—èŠ‚
const height = new DataView(data.buffer).getUint32(4); // è¯»å–ä¸­é—´4å­—èŠ‚
```

- ä½¿ç”¨ `DataView` è¯»å–å¤§ç«¯åºçš„ 32 ä½æ•´æ•°
- ä»å­—èŠ‚æ•°ç»„ä¸­æå–å®½åº¦å’Œé«˜åº¦

### 3. **æå–åƒç´ æ•°æ®**

```typescript
const pixels = new Uint8Array(data.slice(8));
```

- è·³è¿‡å‰ 8 å­—èŠ‚çš„å°ºå¯¸ä¿¡æ¯
- è·å–å‰©ä½™çš„åƒç´ æ•°æ®

### 4. **åˆ›å»ºçº¹ç†**

```typescript
// åˆ›å»º ImageData å¯¹è±¡
const imageData = new ImageData(new Uint8ClampedArray(pixels), width, height);

// é€šè¿‡ä¸´æ—¶ canvas åˆ›å»ºçº¹ç†
const tempCanvas = document.createElement("canvas");
tempCanvas.width = width;
tempCanvas.height = height;
const tempCtx = tempCanvas.getContext("2d");
tempCtx.putImageData(imageData, 0, 0);

// ä¸Šä¼ åˆ° WebGL
gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, tempCanvas);
```

## ğŸ¨ WebGL æ¸²æŸ“

### 1. **åˆå§‹åŒ–èµ„æº**

- åˆ›å»ºç€è‰²å™¨ç¨‹åº
- è®¾ç½®é¡¶ç‚¹ç¼“å†²åŒº
- é…ç½®çº¹ç†åæ ‡

### 2. **è§†å›¾ç®¡ç†**

```typescript
// è®¡ç®—åˆå§‹ç¼©æ”¾æ¯”ä¾‹ï¼Œä½¿å›¾ç‰‡å®Œå…¨æ˜¾ç¤º
const scaleX = canvasWidth / imageWidth; // 798 / 6000 = 0.133
const scaleY = canvasHeight / imageHeight; // 570 / 3818 = 0.149
const scale = Math.min(scaleX, scaleY, 1.0); // å–æœ€å°å€¼ 0.133
```

### 3. **ç»˜åˆ¶**

- æ ¹æ®ç¼©æ”¾æ¯”ä¾‹è®¡ç®—ç»˜åˆ¶ä½ç½®
- ä½¿ç”¨ WebGL ç»˜åˆ¶å›¾ç‰‡åˆ° canvas

## ï¿½ï¿½ å…³é”®æŠ€æœ¯ç‚¹

### 1. **å¤§ç«¯åºï¼ˆBig Endianï¼‰**

```rust
width.to_be_bytes()  // è½¬æ¢ä¸ºå¤§ç«¯åºå­—èŠ‚æ•°ç»„
```

- ç¡®ä¿è·¨å¹³å°ä¸€è‡´æ€§
- å‰ç«¯ä½¿ç”¨ `DataView.getUint32()` æ­£ç¡®è¯»å–

### 2. **å†…å­˜å¸ƒå±€**

```
[å®½åº¦4å­—èŠ‚][é«˜åº¦4å­—èŠ‚][åƒç´ æ•°æ®...]
```

- å›ºå®šå¤´éƒ¨ç»“æ„
- ä¾¿äºå‰ç«¯è§£æ

### 3. **æ€§èƒ½ä¼˜åŒ–**

- Rust ç«¯å®Œæˆè§£ç ï¼Œé¿å…å‰ç«¯è§£ç å¼€é”€
- ç›´æ¥ä¼ è¾“åŸå§‹åƒç´ æ•°æ®
- ä½¿ç”¨ `Uint8Array` é¿å…ç±»å‹è½¬æ¢

### 4. **é”™è¯¯å¤„ç†**

- Rust ç«¯è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- å‰ç«¯ try-catch æ•è·å¼‚å¸¸
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

## ï¿½ï¿½ æ•°æ®å¤§å°åˆ†æ

- **åŸå§‹ PNG**ï¼š37MBï¼ˆå‹ç¼©æ ¼å¼ï¼‰
- **è§£ç å**ï¼š91.6MBï¼ˆ6000Ã—3818Ã—4 å­—èŠ‚ï¼‰
- **ä¼ è¾“æ•ˆç‡**ï¼šè™½ç„¶æ•°æ®å˜å¤§ï¼Œä½†é¿å…äº†å‰ç«¯è§£ç çš„ CPU å¼€é”€

è¿™ç§æ¶æ„çš„ä¼˜åŠ¿æ˜¯ï¼š

1. **åç«¯è§£ç **ï¼šåˆ©ç”¨ Rust çš„é«˜æ€§èƒ½å›¾ç‰‡å¤„ç†
2. **ç›´æ¥ä¼ è¾“**ï¼šé¿å… JSON åºåˆ—åŒ–å¼€é”€
3. **å‰ç«¯æ¸²æŸ“**ï¼šä¸“æ³¨äº WebGL æ¸²æŸ“å’Œç”¨æˆ·äº¤äº’
4. **å†…å­˜ç®¡ç†**ï¼šåˆç†çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾

ç°åœ¨ä½ çš„å›¾ç‰‡åº”è¯¥èƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œå¹¶ä¸”æ”¯æŒæ»šè½®ç¼©æ”¾äº†ï¼
